<button class="home-button" (click)="goBack()">æˆ»ã‚‹</button>

<h2 class="page-title">è³ä¸ ç¤¾ä¼šä¿é™ºæ–™è¨ˆç®—</h2>

<div class="calculation-container">
  <!-- å¾“æ¥­å“¡æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
  <div class="employee-info-section" *ngIf="employeeInfo">
    <h3>å¾“æ¥­å“¡æƒ…å ±</h3>
    <div class="info-grid">
      <div class="info-item">
        <span class="info-label">å¾“æ¥­å“¡ç•ªå·:</span>
        <span>{{ employeeInfo.employeeNumber }}</span>
      </div>
      <div class="info-item">
        <span class="info-label">æ°å:</span>
        <span>{{ employeeInfo.name }}</span>
      </div>
      <div class="info-item">
        <span class="info-label">å¹´é½¢:</span>
        <span>{{ employeeInfo.age }}æ­³</span>
      </div>
      <div class="info-item">
        <span class="info-label">äº‹æ¥­æ‰€æ‰€åœ¨åœ°:</span>
        <span>{{ employeeInfo.addressPrefecture }}</span>
      </div>
    </div>
  </div>

  <!-- å¹´åº¦é¸æŠã¨å–ã‚Šè¾¼ã¿ã‚¨ãƒªã‚¢ -->
  <div class="bonus-control-section">
    <h3>è³ä¸æƒ…å ±å–ã‚Šè¾¼ã¿</h3>

    <div class="control-form">
      <div class="form-row">
        <label for="target-year" class="form-label">å¯¾è±¡å¹´åº¦:</label>
        <select id="target-year" class="form-select" [(ngModel)]="targetYear">
          <option value="2023">2023å¹´åº¦</option>
          <option value="2024">2024å¹´åº¦</option>
          <option value="2025">2025å¹´åº¦</option>
          <option value="2026">2026å¹´åº¦</option>
        </select>
      </div>

      <div class="import-button-area">
        <button
          class="import-btn"
          (click)="importBonusData()"
          [disabled]="!employeeInfo || isLoading"
        >
          <span *ngIf="isLoading">èª­ã¿è¾¼ã¿ä¸­...</span>
          <span *ngIf="!isLoading">ğŸ“¥ è³ä¸ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Excelå½¢å¼ã®è¨ˆç®—çµæœè¡¨ -->
  <div class="result-table-section">
    <h3>è³ä¸ç¤¾ä¼šä¿é™ºæ–™è¨ˆç®—çµæœ</h3>

    <div class="excel-table">
      <table>
        <thead>
          <tr>
            <th>æ”¯çµ¦å¹´æœˆæ—¥</th>
            <th>å ±é…¬é¡</th>
            <th>å¥åº·ä¿é™ºæ–™ãƒ»ä»‹è­·ä¿é™ºæ–™ã®ç­‰ç´š</th>
            <th>å¥åº·ä¿é™ºæ–™å¾“æ¥­å“¡è² æ‹…åˆ†</th>
            <th>å¥åº·ä¿é™ºæ–™ä¼šç¤¾è² æ‹…åˆ†</th>
            <th>ä»‹è­·ä¿é™ºæ–™å¾“æ¥­å“¡è² æ‹…åˆ†</th>
            <th>ä»‹è­·ä¿é™ºæ–™ä¼šç¤¾è² æ‹…åˆ†</th>
            <th>åšç”Ÿå¹´é‡‘ã®ç­‰ç´š</th>
            <th>åšç”Ÿå¹´é‡‘ä¿é™ºæ–™å¾“æ¥­å“¡è² æ‹…åˆ†</th>
            <th>åšç”Ÿå¹´é‡‘ä¿é™ºæ–™ä¼šç¤¾è² æ‹…åˆ†</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let bonus of bonusDataList; let i = index">
            <td>{{ bonus.paymentDate || '-' }}</td>
            <td>{{ bonus.amount ? (bonus.amount | number: '1.0-0') : '-' }}</td>
            <td>
              {{
                bonus.calculationResult
                  ? getHealthInsuranceGrade(bonus.calculationResult.standardBonusAmountHealth)
                  : '-'
              }}
            </td>
            <td>
              {{
                bonus.calculationResult
                  ? (bonus.calculationResult.healthInsurance.employeeBurden | number: '1.0-0')
                  : '-'
              }}
            </td>
            <td>
              {{
                bonus.calculationResult
                  ? (bonus.calculationResult.healthInsurance.companyBurden | number: '1.0-0')
                  : '-'
              }}
            </td>
            <td>
              {{
                bonus.calculationResult
                  ? (bonus.calculationResult.careInsurance?.employeeBurden || 0 | number: '1.0-0')
                  : '-'
              }}
            </td>
            <td>
              {{
                bonus.calculationResult
                  ? (bonus.calculationResult.careInsurance?.companyBurden || 0 | number: '1.0-0')
                  : '-'
              }}
            </td>
            <td>
              {{
                bonus.calculationResult
                  ? getPensionInsuranceGrade(bonus.calculationResult.standardBonusAmountPension)
                  : '-'
              }}
            </td>
            <td>
              {{
                bonus.calculationResult
                  ? (bonus.calculationResult.pensionInsurance.employeeBurden | number: '1.0-0')
                  : '-'
              }}
            </td>
            <td>
              {{
                bonus.calculationResult
                  ? (bonus.calculationResult.pensionInsurance.companyBurden | number: '1.0-0')
                  : '-'
              }}
            </td>
          </tr>
          <!-- ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®ç©ºè¡Œè¡¨ç¤º -->
          <tr *ngIf="bonusDataList.length === 0">
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ä¸Šé™é©ç”¨ã®æ³¨è¨˜ -->
    <div class="notes" *ngIf="hasLimitApplied">
      <h4>âš ï¸ æ³¨è¨˜</h4>
      <ul>
        <li *ngFor="let note of limitNotes">{{ note }}</li>
      </ul>
    </div>
  </div>

  <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
  <div class="error-message" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>
</div>
