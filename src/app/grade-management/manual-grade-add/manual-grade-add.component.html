<div class="manual-grade-add-container">
  <div class="header-section">
    <button class="back-btn" (click)="goBack()">â† æˆ»ã‚‹</button>
    <h1 class="page-title">æ‰‹å…¥åŠ›ã§ç­‰ç´šè¿½åŠ </h1>
  </div>

  <!-- å¾“æ¥­å“¡æƒ…å ± -->
  <div class="employee-info-section">
    <h3>å¾“æ¥­å“¡æƒ…å ±</h3>

    <div class="loading" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>

    <div class="error-message" *ngIf="errorMessage && !isLoading">
      <p>{{ errorMessage }}</p>
    </div>

    <div class="employee-details" *ngIf="employeeInfo && !isLoading">
      <div class="info-row">
        <span class="label">å¾“æ¥­å“¡å:</span>
        <span class="value">{{ employeeInfo.name }}</span>
      </div>
      <div class="info-row">
        <span class="label">å¾“æ¥­å“¡ç•ªå·:</span>
        <span class="value">{{ employeeInfo.employeeNumber }}</span>
      </div>
      <div class="info-row">
        <span class="label">ç”Ÿå¹´æœˆæ—¥:</span>
        <span class="value">{{ employeeInfo.birthDate }}</span>
      </div>
      <div class="info-row">
        <span class="label">å¹´é½¢:</span>
        <span class="value">{{ employeeInfo.age }}æ­³</span>
      </div>
      <div class="info-row">
        <span class="label">äº‹æ¥­æ‰€ç•ªå·:</span>
        <span class="value">{{ employeeInfo.branchNumber }}</span>
      </div>
      <div class="info-row">
        <span class="label">äº‹æ¥­æ‰€æ‰€åœ¨åœ°:</span>
        <span class="value">{{ employeeInfo.addressPrefecture }}</span>
      </div>
    </div>
  </div>

  <!-- ç­‰ç´šåˆ¤å®šå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div class="grade-input-section">
    <h3>ç­‰ç´šåˆ¤å®šæƒ…å ±å…¥åŠ›</h3>

    <div class="form-content">
      <!-- æœˆé¡å ±é…¬å…¥åŠ› -->
      <div class="form-group">
        <label for="monthlyAmount">æœˆé¡å ±é…¬ *</label>
        <input
          type="number"
          id="monthlyAmount"
          [(ngModel)]="monthlyAmount"
          (ngModelChange)="onMonthlyAmountChange()"
          placeholder="ä¾‹: 376479"
          min="0"
          step="1"
        />
        <small class="help-text"
          >æ¨™æº–å ±é…¬æœˆé¡ã®ç®—å®šã«ä½¿ç”¨ã™ã‚‹æœˆé¡å ±é…¬ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¸€ã®ä½ã¾ã§å…¥åŠ›å¯èƒ½ï¼‰</small
        >
      </div>

      <!-- é©ç”¨æœŸé–“å…¥åŠ› -->
      <div class="form-group">
        <label for="applicableYear">é©ç”¨é–‹å§‹å¹´æœˆ *</label>
        <div class="date-input-row">
          <select id="applicableYear" [(ngModel)]="applicableYear">
            <option value="">å¹´ã‚’é¸æŠ</option>
            <option *ngFor="let year of availableYears" [value]="year">{{ year }}å¹´</option>
          </select>
          <select id="applicableMonth" [(ngModel)]="applicableMonth">
            <option value="">æœˆã‚’é¸æŠ</option>
            <option *ngFor="let month of availableMonths" [value]="month.value">
              {{ month.label }}
            </option>
          </select>
        </div>
      </div>

      <!-- é©ç”¨çµ‚äº†æœŸé–“ï¼ˆä»»æ„ï¼‰ -->
      <div class="form-group">
        <label for="endYear">é©ç”¨çµ‚äº†å¹´æœˆï¼ˆä»»æ„ï¼‰</label>
        <div class="date-input-row">
          <select id="endYear" [(ngModel)]="endYear">
            <option value="">å¹´ã‚’é¸æŠ</option>
            <option *ngFor="let year of availableYears" [value]="year">{{ year }}å¹´</option>
          </select>
          <select id="endMonth" [(ngModel)]="endMonth">
            <option value="">æœˆã‚’é¸æŠ</option>
            <option *ngFor="let month of availableMonths" [value]="month.value">
              {{ month.label }}
            </option>
          </select>
        </div>
        <small class="help-text">ç¶™ç¶šé©ç”¨ã®å ´åˆã¯ç©ºæ¬„ã®ã¾ã¾ã«ã—ã¦ãã ã•ã„</small>
      </div>
    </div>

    <!-- ãƒ•ã‚©ãƒ¼ãƒ ä¸‹ã®ãƒœã‚¿ãƒ³ï¼ˆåˆ¤å®šçµæœãŒãªã„å ´åˆã‚‚è¡¨ç¤ºï¼‰ -->
    <div class="form-button-section">
      <button
        type="button"
        class="judgment-btn"
        (click)="calculateGrade()"
        [disabled]="!isFormValid()"
      >
        åˆ¤å®š
      </button>
    </div>
  </div>

  <!-- åˆ¤å®šçµæœè¡¨ç¤º -->
  <div class="result-section" *ngIf="judgmentResult">
    <h3 class="section-title">åˆ¤å®šçµæœ</h3>

    <div class="result-content">
      <!-- é©ç”¨æœŸé–“è¡¨ç¤º -->
      <div class="form-group period-group">
        <div class="period-label">é©ç”¨æœŸé–“</div>
        <div class="period-display">
          <span class="period-text">
            {{ applicableYear }}å¹´{{ applicableMonth }}æœˆ ï½
            <span *ngIf="endYear && endMonth">{{ endYear }}å¹´{{ endMonth }}æœˆ</span>
            <span *ngIf="!endYear || !endMonth">ç¶™ç¶š</span>
          </span>
        </div>
      </div>

      <!-- å¥åº·ä¿é™º -->
      <div class="form-group insurance-group">
        <div class="insurance-label">
          <span class="insurance-icon">ğŸ¥</span>
          å¥åº·ä¿é™º
        </div>
        <div class="insurance-info">
          <div class="info-item">
            <span class="info-label">ç­‰ç´š:</span>
            <span class="info-value">{{ judgmentResult.healthInsuranceGrade }}ç´š</span>
          </div>
          <div class="info-item">
            <span class="info-label">æœˆé¡:</span>
            <span class="info-value"
              >{{ judgmentResult.healthInsuranceStandardSalary | number }}å††</span
            >
          </div>
          <div class="info-item">
            <span class="info-label">æœŸé–“:</span>
            <span class="info-value">
              <span *ngIf="!endYear || !endMonth">ç¶™ç¶š</span>
              <span *ngIf="endYear && endMonth">{{ endYear }}å¹´{{ endMonth }}æœˆã¾ã§</span>
            </span>
          </div>
        </div>
      </div>

      <!-- åšç”Ÿå¹´é‡‘ä¿é™º -->
      <div class="form-group insurance-group">
        <div class="insurance-label">
          <span class="insurance-icon">ğŸ‘´</span>
          åšç”Ÿå¹´é‡‘ä¿é™º
        </div>
        <div class="insurance-info">
          <div class="info-item">
            <span class="info-label">ç­‰ç´š:</span>
            <span class="info-value">{{ judgmentResult.pensionInsuranceGrade }}ç´š</span>
          </div>
          <div class="info-item">
            <span class="info-label">æœˆé¡:</span>
            <span class="info-value"
              >{{ judgmentResult.pensionInsuranceStandardSalary | number }}å††</span
            >
          </div>
          <div class="info-item">
            <span class="info-label">æœŸé–“:</span>
            <span class="info-value">
              <span *ngIf="!endYear || !endMonth">ç¶™ç¶š</span>
              <span *ngIf="endYear && endMonth">{{ endYear }}å¹´{{ endMonth }}æœˆã¾ã§</span>
            </span>
          </div>
        </div>
      </div>

      <!-- ä»‹è­·ä¿é™º -->
      <div class="form-group insurance-group">
        <div class="insurance-label">
          <span class="insurance-icon">ğŸ¤</span>
          ä»‹è­·ä¿é™º
        </div>
        <div class="insurance-info" *ngIf="judgmentResult.careInsuranceGrade">
          <div class="info-item">
            <span class="info-label">ç­‰ç´š:</span>
            <span class="info-value">{{ judgmentResult.careInsuranceGrade }}ç´š</span>
          </div>
          <div class="info-item">
            <span class="info-label">æœˆé¡:</span>
            <span class="info-value"
              >{{ judgmentResult.careInsuranceStandardSalary | number }}å††</span
            >
          </div>
          <div class="info-item">
            <span class="info-label">æœŸé–“:</span>
            <span class="info-value">
              <span *ngIf="!endYear || !endMonth">ç¶™ç¶š</span>
              <span *ngIf="endYear && endMonth">{{ endYear }}å¹´{{ endMonth }}æœˆã¾ã§</span>
            </span>
          </div>
        </div>
        <div class="insurance-info not-applicable" *ngIf="!judgmentResult.careInsuranceGrade">
          <div class="info-item">
            <span class="info-value not-applicable-text">å¯¾è±¡å¤–ï¼ˆ40æ­³æœªæº€ï¼‰</span>
          </div>
        </div>
      </div>

      <!-- ä¿å­˜çŠ¶æ…‹è¡¨ç¤º -->
      <div class="form-group save-group" *ngIf="savedGradeData">
        <div class="save-status">
          <span class="save-icon">âœ…</span>
          <span class="save-text">ä¿å­˜æ¸ˆã¿ ({{ getFormattedDate(savedGradeData.updatedAt) }})</span>
        </div>
      </div>
    </div>

    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
    <div class="button-section">
      <button
        type="button"
        class="save-btn"
        (click)="saveGradeData()"
        [disabled]="!isSaveValid() || isSaving"
        *ngIf="!savedGradeData"
      >
        <span *ngIf="isSaving">ä¿å­˜ä¸­...</span>
        <span *ngIf="!isSaving">ä¿å­˜</span>
      </button>

      <button
        type="button"
        class="delete-btn"
        (click)="deleteGradeData()"
        [disabled]="isSaving"
        *ngIf="savedGradeData"
      >
        <span *ngIf="isSaving">å‰Šé™¤ä¸­...</span>
        <span *ngIf="!isSaving">å‰Šé™¤</span>
      </button>
    </div>
  </div>
</div>
