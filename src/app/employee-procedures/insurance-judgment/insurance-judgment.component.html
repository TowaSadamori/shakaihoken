<div class="judgment-container">
  <div class="header-container">
    <button class="btn-back" (click)="goBack()">
      <i class="icon-arrow-left"></i>
      å¾“æ¥­å“¡ä¸€è¦§ã«æˆ»ã‚‹
    </button>
    <h2>ç¤¾ä¼šä¿é™ºå¯¾è±¡è€…åˆ¤å®š</h2>
  </div>

  <!-- å¯¾è±¡è€…æƒ…å ± -->
  <div class="employee-info">
    <h3>å¯¾è±¡è€…æƒ…å ±</h3>
    <div class="info-grid">
      <div class="info-item">
        <div class="label">å¾“æ¥­å“¡å:</div>
        <span>{{ employeeName }}</span>
      </div>
      <div class="info-item">
        <div class="label">å¾“æ¥­å“¡ç•ªå·:</div>
        <span>{{ employeeNumber }}</span>
      </div>
      <div class="info-item">
        <div class="label">ç”Ÿå¹´æœˆæ—¥:</div>
        <span>{{ birthDate | date: 'yyyyå¹´Mæœˆdæ—¥' }}</span>
      </div>
      <div class="info-item">
        <div class="label">å¹´é½¢:</div>
        <span>{{ age }}æ­³</span>
      </div>
      <div class="info-item">
        <div class="label">äº‹æ¥­æ‰€ç•ªå·:</div>
        <span>{{ officeNumber }}</span>
      </div>
      <div class="info-item">
        <div class="label">äº‹æ¥­æ‰€æ‰€åœ¨åœ°:</div>
        <span>{{ officePrefecture }}</span>
      </div>
    </div>
  </div>

  <!-- å±æ€§ç·¨é›†ãƒœã‚¿ãƒ³ -->
  <div class="attribute-edit-section" *ngIf="!showQuestionnaire && !judgmentResult">
    <div class="edit-prompt">
      <p>å¾“æ¥­å“¡ã®å±æ€§ã‚’è¨­å®šã™ã‚‹ãŸã‚ã«è³ªå•ã«ç­”ãˆã¦ãã ã•ã„</p>
      <button class="btn-primary" (click)="startAttributeEdit()">å±æ€§ã‚’ç·¨é›†ã™ã‚‹</button>
    </div>
  </div>

  <!-- è³ªå•ã‚¨ãƒªã‚¢ -->
  <div class="questionnaire" *ngIf="showQuestionnaire && currentQuestion">
    <h3>è³ªå• {{ getQuestionNumber() }}</h3>

    <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
    <div class="debug-info" *ngIf="showDebugInfo">
      <button (click)="hideDebugInfo()" class="debug-close-btn">âœ• é–‰ã˜ã‚‹</button>
      <strong>ğŸ” ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒãƒƒã‚°æƒ…å ±:</strong><br />
      ğŸ“‹ ç¾åœ¨ã®è³ªå•ID: {{ currentQuestionId }}<br />
      â“ ç¾åœ¨ã®è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ: {{ currentQuestion.text }}<br />
      ğŸ“ ç¾åœ¨ã®è³ªå•ã®å›ç­”: {{ answers[currentQuestionId] }}<br />
      ğŸ“š è³ªå•å±¥æ­´: {{ questionHistory | json }}<br />
      ğŸ“Š å±¥æ­´ã®é•·ã•: {{ questionHistory.length }}<br />
      â¬…ï¸ æˆ»ã‚‹ã“ã¨ãŒã§ãã‚‹: {{ canGoToPreviousQuestion }}<br />
      ğŸ” nextQuestionè¨­å®š: {{ currentQuestion.nextQuestion | json }}<br />
      ğŸ“ å…¨å›ç­”ãƒ‡ãƒ¼ã‚¿: {{ answers | json }}<br />
      ğŸ¯ é›‡ç”¨å½¢æ…‹: {{ answers['employmentType'] }}<br />
      <button (click)="debugCurrentState()" class="debug-detail-btn">è©³ç´°ãƒ‡ãƒãƒƒã‚°</button>
    </div>

    <!-- å‰ã®è³ªå•ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
    <div class="question-navigation" *ngIf="canGoToPreviousQuestion">
      <button class="btn-previous" (click)="goToPreviousQuestion()">
        <i class="icon-arrow-left"></i>
        å‰ã®è³ªå•ã«æˆ»ã‚‹
      </button>
    </div>

    <div class="questions">
      <div class="question-item">
        <div class="question-text">{{ currentQuestion.text }}</div>

        <!-- é¸æŠå¼è³ªå• -->
        <div class="answer-options" *ngIf="currentQuestion.type === 'choice'">
          <label *ngFor="let choice of currentQuestion.choices">
            <input
              type="radio"
              [name]="currentQuestion.id"
              [value]="choice.value"
              [(ngModel)]="answers[currentQuestion.id]"
              (change)="updateAnswers()"
            />
            {{ choice.label }}
          </label>
        </div>

        <!-- ã¯ã„/ã„ã„ãˆè³ªå• -->
        <div class="answer-options" *ngIf="currentQuestion.type === 'yesno'">
          <label>
            <input
              type="radio"
              [name]="currentQuestion.id"
              value="yes"
              [(ngModel)]="answers[currentQuestion.id]"
              (change)="logChangeEvent('ã¯ã„', currentQuestion.id); updateAnswers()"
              (click)="
                logRadioClick('ã¯ã„', currentQuestion.id);
                handleRadioClick('yes', currentQuestion.id)
              "
            />
            ã¯ã„
          </label>
          <label>
            <input
              type="radio"
              [name]="currentQuestion.id"
              value="no"
              [(ngModel)]="answers[currentQuestion.id]"
              (change)="logChangeEvent('ã„ã„ãˆ', currentQuestion.id); updateAnswers()"
              (click)="
                logRadioClick('ã„ã„ãˆ', currentQuestion.id);
                handleRadioClick('no', currentQuestion.id)
              "
            />
            ã„ã„ãˆ
          </label>
        </div>

        <!-- æ—¥ä»˜ç¯„å›²è³ªå• -->
        <div class="date-range-options" *ngIf="currentQuestion.type === 'date-range'">
          <div class="period-selection">
            <div class="date-input-section">
              <h4>æœŸé–“ã‚’æŒ‡å®šã—ã¦ãã ã•ã„</h4>
              <div class="date-inputs">
                <div class="date-field">
                  <div class="field-label">é–‹å§‹æ—¥:</div>
                  <input type="date" #startDate class="date-input" />
                </div>
                <div class="date-field">
                  <div class="field-label">çµ‚äº†äºˆå®šæ—¥:</div>
                  <input type="date" #endDate class="date-input" />
                </div>
              </div>
              <button
                class="period-button custom-button"
                (click)="updateDateRange(startDate.value, endDate.value)"
                [disabled]="!startDate.value || !endDate.value"
              >
                æœŸé–“ã‚’è¨­å®šã—ã¦æ¬¡ã¸
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- åˆ¤å®šçµæœ -->
  <div class="judgment-result" *ngIf="judgmentResult">
    <div class="result-header">
      <h3>åˆ¤å®šçµæœ</h3>
      <div class="result-buttons">
        <button class="btn-reset" (click)="resetQuestionnaire()">
          <i class="icon-refresh"></i>
          åˆ¤å®šã‚’ã‚„ã‚Šç›´ã™
        </button>
        <button class="btn-save" (click)="saveJudgment()">
          <i class="icon-save"></i>
          åˆ¤å®šçµæœã‚’ä¿å­˜
        </button>
      </div>
    </div>

    <!-- åˆ¤å®šçµæœãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
    <div class="debug-info debug-info-result" *ngIf="showDebugInfo">
      <button (click)="hideDebugInfo()" class="debug-close-btn">âœ• é–‰ã˜ã‚‹</button>
      <strong>ğŸ” åˆ¤å®šçµæœãƒ‡ãƒãƒƒã‚°æƒ…å ±:</strong><br />
      ğŸ“ å…¨å›ç­”ãƒ‡ãƒ¼ã‚¿: {{ answers | json }}<br />
      ğŸ¯ é›‡ç”¨å½¢æ…‹: {{ answers['employmentType'] }}<br />
      ğŸ“š è³ªå•å±¥æ­´: {{ questionHistory | json }}<br />
      ğŸ¥ å¥åº·ä¿é™ºåˆ¤å®š: {{ judgmentResult.healthInsurance | json }}<br />
      ğŸ›ï¸ åšç”Ÿå¹´é‡‘åˆ¤å®š: {{ judgmentResult.pensionInsurance | json }}<br />
      ğŸ§“ ä»‹è­·ä¿é™ºåˆ¤å®š: {{ judgmentResult.careInsurance | json }}<br />
      ğŸ“… å¹´é½¢: {{ age }}æ­³<br />
      ğŸ¢ ä¼‘è·çŠ¶æ³: {{ answers['leaveStatus'] }}<br />
      ğŸ“‹ æ‰‹å…¥åŠ›å¥åº·ä¿é™º: {{ answers['manualHealthInsurance'] }}<br />
      ğŸ“‹ æ‰‹å…¥åŠ›åšç”Ÿå¹´é‡‘: {{ answers['manualPensionInsurance'] }}<br />
      <button (click)="debugCurrentState()" class="debug-detail-btn">è©³ç´°ãƒ‡ãƒãƒƒã‚°</button>
    </div>

    <!-- ä¼‘è·æƒ…å ±è¡¨ç¤º -->
    <div class="leave-info" *ngIf="getLeaveInfo()">
      <h4>ä¼‘è·æƒ…å ±</h4>
      <div class="leave-details">
        <div class="leave-type">
          <span class="label">ä¼‘è·ç¨®åˆ¥:</span>
          <span class="value">{{ getLeaveTypeLabel() }}</span>
        </div>
        <div class="leave-period" *ngIf="getLeavePeriodInfo()">
          <span class="label">å…é™¤æœŸé–“:</span>
          <span class="value">{{ getLeavePeriodInfo() }}</span>
        </div>
      </div>
    </div>

    <div class="result-cards">
      <div class="result-card">
        <h4>å¥åº·ä¿é™ºæ–™ãƒ»ä»‹è­·ä¿é™ºæ–™</h4>
        <div
          class="status"
          [class]="judgmentResult.healthInsurance.eligible ? 'eligible' : 'not-eligible'"
        >
          {{ judgmentResult.healthInsurance.eligible ? 'åŠ å…¥å¯¾è±¡' : 'åŠ å…¥å¯¾è±¡å¤–' }}
        </div>
        <p>{{ judgmentResult.healthInsurance.reason }}</p>
        <div *ngIf="judgmentResult.healthInsurance.eligible && careInsurancePeriod">
          <span style="font-weight: bold">ä»‹è­·ä¿é™ºæ–™è©²å½“æœŸé–“:</span>
          {{ formatJapaneseYearMonth(careInsurancePeriod.start) }} ï½
          {{ formatJapaneseYearMonth(careInsurancePeriod.end) }}
        </div>
        <div *ngIf="judgmentResult.healthInsurance.eligible && healthInsurancePeriod">
          <span style="font-weight: bold">å¥åº·ä¿é™ºæ–™è©²å½“æœŸé–“:</span>
          {{ formatJapaneseYearMonth(healthInsurancePeriod.start) }} ï½
          {{ formatJapaneseYearMonth(healthInsurancePeriod.end) }}
        </div>
      </div>

      <div class="result-card">
        <h4>åšç”Ÿå¹´é‡‘ä¿é™ºæ–™</h4>
        <div
          class="status"
          [class]="judgmentResult.pensionInsurance.eligible ? 'eligible' : 'not-eligible'"
        >
          {{ judgmentResult.pensionInsurance.eligible ? 'åŠ å…¥å¯¾è±¡' : 'åŠ å…¥å¯¾è±¡å¤–' }}
        </div>
        <p>{{ judgmentResult.pensionInsurance.reason }}</p>
        <div *ngIf="judgmentResult.pensionInsurance.eligible && pensionInsurancePeriod">
          <span style="font-weight: bold">åšç”Ÿå¹´é‡‘ä¿é™ºæ–™è©²å½“æœŸé–“:</span>
          {{ formatJapaneseYearMonth(pensionInsurancePeriod.start) }}
          <ng-container *ngIf="pensionInsurancePeriod.end; else noLimit">
            ï½ {{ formatJapaneseYearMonth(pensionInsurancePeriod.end) }}
          </ng-container>
          <ng-template #noLimit>ï½ï¼ˆä¸Šé™ãªã—ï¼‰</ng-template>
        </div>
      </div>
    </div>
  </div>

  <!-- è¿½åŠ è³ªå•ï¼ˆç¤¾ä¼šä¿é™ºåŠ å…¥å¯¾è±¡è€…ã®ã¿ï¼‰ -->
  <div class="additional-questions" *ngIf="judgmentResult && isInsuranceEligible()">
    <div class="section-header">
      <h3>è¿½åŠ æƒ…å ±ã®å…¥åŠ›</h3>
      <p>è©²å½“ã™ã‚‹äº‹ä¾‹ãŒã‚ã‚‹å ´åˆã¯é¸æŠã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰</p>
    </div>

    <div class="special-cases">
      <!-- ç‰¹æ®Šäº‹ä¾‹ãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div class="no-cases-message" *ngIf="selectedSpecialCases.length === 0">
        <span class="icon">ğŸ“‹</span>
        <p>ç¾åœ¨ã€è¿½åŠ æƒ…å ±ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
      </div>

      <div class="case-item" *ngFor="let specialCase of selectedSpecialCases; let i = index">
        <div class="case-header">
          <button class="btn-remove" (click)="removeSpecialCase(i)">
            <i class="icon-close"></i>
            å‰Šé™¤
          </button>
        </div>

        <div class="case-selection">
          <label [for]="'case-type-' + i">äº‹ä¾‹ã®ç¨®é¡:</label>
          <select
            [id]="'case-type-' + i"
            [(ngModel)]="specialCase.type"
            (change)="onSpecialCaseTypeChange(i)"
          >
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="maternity-leave">ç”£å‰ç”£å¾Œä¼‘æ¥­æœŸé–“ä¸­ã®ä¿é™ºæ–™å…é™¤</option>
            <option value="childcare-leave">è‚²å…ä¼‘æ¥­ç­‰æœŸé–“ä¸­ã®ä¿é™ºæ–™å…é™¤</option>
            <option value="other-leave">ãã®ä»–ã®ä¼‘è·</option>
            <option value="secondment">å‡ºå‘è€…ã®ç¤¾ä¼šä¿é™ºåŠ å…¥</option>
            <option value="multiple-workplace">äºŒä»¥ä¸Šäº‹æ¥­æ‰€å‹¤å‹™è€…</option>
          </select>
        </div>

        <!-- ç”£å‰ç”£å¾Œä¼‘æ¥­ã®è©³ç´°ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="case-details" *ngIf="specialCase.type === 'maternity-leave'">
          <div class="form-grid">
            <div class="form-group">
              <label [for]="'pregnancy-type-' + i">å¦Šå¨ ã®ç¨®é¡:</label>
              <select
                [id]="'pregnancy-type-' + i"
                [(ngModel)]="specialCase.details.pregnancyType"
                (change)="calculateMaternityPeriod(i)"
              >
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="single">å˜èƒ</option>
                <option value="multiple">å¤šèƒ</option>
              </select>
            </div>

            <div class="form-group">
              <label [for]="'expected-birth-date-' + i">å‡ºç”£äºˆå®šæ—¥:</label>
              <input
                [id]="'expected-birth-date-' + i"
                type="date"
                [(ngModel)]="specialCase.details.expectedBirthDate"
                (change)="calculateMaternityPeriod(i)"
              />
            </div>

            <div class="form-group">
              <label [for]="'actual-birth-date-' + i">å®Ÿéš›ã®å‡ºç”£æ—¥ï¼ˆä»»æ„ï¼‰:</label>
              <input
                [id]="'actual-birth-date-' + i"
                type="date"
                [(ngModel)]="specialCase.details.actualBirthDate"
                (change)="calculateMaternityPeriod(i); onActualBirthDateChange(i)"
              />
            </div>

            <!-- è¨ˆç®—ã•ã‚ŒãŸæœ€å¤§æœŸé–“è¡¨ç¤º -->
            <div class="form-group full-width" *ngIf="getCalculatedMaternityPeriod(i)">
              <div class="calculated-period">
                <h5>æ³•å®šæœ€å¤§æœŸé–“ï¼ˆå‚è€ƒï¼‰</h5>
                <div class="period-info">
                  <div class="period-item">
                    <span class="label">ç”£å‰æœŸé–“:</span>
                    <span class="value">{{ getCalculatedMaternityPeriod(i)?.preNatalPeriod }}</span>
                  </div>
                  <div class="period-item">
                    <span class="label">ç”£å¾ŒæœŸé–“:</span>
                    <span class="value">{{
                      getCalculatedMaternityPeriod(i)?.postNatalPeriod
                    }}</span>
                  </div>
                  <div class="period-item total">
                    <span class="label">æœ€å¤§å…é™¤æœŸé–“:</span>
                    <span class="value">{{ getCalculatedMaternityPeriod(i)?.totalPeriod }}</span>
                  </div>
                  <div class="period-item exemption">
                    <span class="label">ç¤¾ä¼šä¿é™ºæ–™å…é™¤æœŸé–“:</span>
                    <span class="value">{{
                      getCalculatedMaternityPeriod(i)?.exemptionPeriod
                    }}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- å®Ÿéš›ã®ç”³è«‹æœŸé–“é¸æŠ -->
            <div class="form-group full-width" *ngIf="getCalculatedMaternityPeriod(i)">
              <div class="actual-period-selection">
                <h5>å®Ÿéš›ã®ç¤¾ä¼šä¿é™ºæ–™å…é™¤æœŸé–“</h5>

                <!-- ç”£å‰ãƒ»ç”£å¾ŒæœŸé–“ã®å…¥åŠ› -->
                <div class="period-breakdown">
                  <div class="period-section prenatal">
                    <div class="period-header">
                      <span class="period-title">ç”£å‰ã®æœŸé–“</span>
                      <div class="period-inputs">
                        <input
                          type="date"
                          [(ngModel)]="specialCase.details.preNatalStartDate"
                          [value]="specialCase.details.preNatalStartDate || getPreNatalStartDate(i)"
                          (ngModelChange)="onPreNatalStartDateChange(i, $event)"
                          class="period-date-input"
                          placeholder="é–‹å§‹æ—¥"
                        />
                        <span class="date-separator">ï½</span>
                        <input
                          type="date"
                          [(ngModel)]="specialCase.details.preNatalEndDate"
                          [value]="specialCase.details.preNatalEndDate || getPreNatalEndDate(i)"
                          (ngModelChange)="onPreNatalEndDateChange(i, $event)"
                          class="period-date-input"
                          placeholder="çµ‚äº†æ—¥"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="period-section postnatal">
                    <div class="period-header">
                      <span class="period-title">ç”£å¾Œã®æœŸé–“</span>
                      <div class="period-inputs">
                        <input
                          type="date"
                          [(ngModel)]="specialCase.details.postNatalStartDate"
                          [value]="
                            specialCase.details.postNatalStartDate || getPostNatalStartDate(i)
                          "
                          (ngModelChange)="onPostNatalStartDateChange(i, $event)"
                          class="period-date-input"
                          placeholder="é–‹å§‹æ—¥"
                        />
                        <span class="date-separator">ï½</span>
                        <input
                          type="date"
                          [(ngModel)]="specialCase.details.postNatalEndDate"
                          [value]="specialCase.details.postNatalEndDate || getPostNatalEndDate(i)"
                          [min]="getPostNatalStartDate(i)"
                          [max]="getPostNatalMaxDate(i)"
                          (ngModelChange)="onPostNatalEndDateChange(i, $event)"
                          class="period-date-input"
                          placeholder="çµ‚äº†æ—¥"
                        />
                      </div>
                    </div>
                  </div>
                </div>

                <!-- ç¤¾ä¼šä¿é™ºæ–™å…é™¤æœŸé–“ã®è¡¨ç¤º -->
                <div class="exemption-period-display">
                  <div class="exemption-bar">
                    <span class="exemption-label">ç¤¾ä¼šä¿é™ºæ–™å…é™¤æœŸé–“:</span>
                    <span class="exemption-period">{{ getActualExemptionPeriod(i) }}</span>
                  </div>
                </div>

                <div
                  class="selected-period-info"
                  *ngIf="specialCase.details.actualStartDate && specialCase.details.actualEndDate"
                >
                  <div class="info-item">
                    <span class="label">é¸æŠã•ã‚ŒãŸæœŸé–“:</span>
                    <span class="value"
                      >{{ specialCase.details.actualStartDate }} ï½
                      {{ specialCase.details.actualEndDate }}</span
                    >
                  </div>
                  <div class="info-item">
                    <span class="label">ç”³è«‹æ—¥æ•°:</span>
                    <span class="value">{{ getSelectedPeriodDays(i) }}æ—¥é–“</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-group full-width">
              <label [for]="'maternity-remarks-' + i">å‚™è€ƒ:</label>
              <textarea
                [id]="'maternity-remarks-' + i"
                [(ngModel)]="specialCase.details.remarks"
                placeholder="ç”£å‰ç”£å¾Œä¼‘æ¥­ã«é–¢ã™ã‚‹ç‰¹è¨˜äº‹é …ãªã©"
              ></textarea>
            </div>
          </div>

          <!-- ç”£å‰ç”£å¾Œä¼‘æ¥­ã®ä¿å­˜ãƒœã‚¿ãƒ³ -->
          <div class="case-save-section">
            <button
              class="btn-save-case"
              (click)="saveSpecialCase(i)"
              [disabled]="!canSaveMaternityCase(i)"
            >
              <i class="icon-save"></i>
              ã“ã®æƒ…å ±ã‚’ä¿å­˜
            </button>
            <div class="save-status" *ngIf="specialCase.saveStatus">
              <span class="status-icon" [class]="specialCase.saveStatus">
                {{
                  specialCase.saveStatus === 'saved'
                    ? 'âœ“'
                    : specialCase.saveStatus === 'saving'
                      ? 'â³'
                      : 'âœ—'
                }}
              </span>
              <span class="status-text">
                {{ getSpecialCaseSaveStatusText(specialCase.saveStatus) }}
              </span>
            </div>
          </div>
        </div>

        <!-- è‚²ä¼‘ã®è©³ç´°ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="case-details" *ngIf="specialCase.type === 'childcare-leave'">
          <div class="form-grid">
            <!-- è‚²å…ä¼‘æ¥­ã®ç¨®é¡ã¨å­ã®ç”Ÿå¹´æœˆæ—¥ï¼ˆæ¨ªä¸¦ã³ï¼‰ -->
            <div class="form-group">
              <label [for]="'childcare-type-' + i" class="form-label">è‚²å…ä¼‘æ¥­ã®ç¨®é¡:</label>
              <select
                [id]="'childcare-type-' + i"
                [(ngModel)]="specialCase.details.childcareType"
                (change)="calculateChildcarePeriod(i)"
                class="form-select"
              >
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="basic">åŸºæœ¬ã®è‚²å…ä¼‘æ¥­</option>
                <option value="papa-leave">ç”£å¾Œãƒ‘ãƒ‘è‚²ä¼‘ï¼ˆå‡ºç”Ÿæ™‚è‚²å…ä¼‘æ¥­ï¼‰</option>
                <option value="extended-1-6">å»¶é•·è‚²å…ä¼‘æ¥­ï¼ˆ1æ­³ï½1æ­³6ã‹æœˆï¼‰</option>
                <option value="extended-2">å»¶é•·è‚²å…ä¼‘æ¥­ï¼ˆ1æ­³6ã‹æœˆï½2æ­³ï¼‰</option>
                <option value="similar-measures">è‚²å…ä¼‘æ¥­ã«æº–ãšã‚‹æªç½®</option>
              </select>
            </div>

            <div class="form-group">
              <label [for]="'child-birth-date-' + i" class="form-label">å­ã®ç”Ÿå¹´æœˆæ—¥:</label>
              <input
                [id]="'child-birth-date-' + i"
                type="date"
                [(ngModel)]="specialCase.details.childBirthDate"
                (change)="calculateChildcarePeriod(i)"
                class="form-input"
              />
            </div>

            <!-- è‚²å…ä¼‘æ¥­é–‹å§‹æ—¥ã¨çµ‚äº†äºˆå®šæ—¥ï¼ˆæ¨ªä¸¦ã³ï¼‰ -->
            <div class="form-group">
              <label [for]="'childcare-start-' + i" class="form-label">è‚²å…ä¼‘æ¥­é–‹å§‹æ—¥:</label>
              <input
                [id]="'childcare-start-' + i"
                type="date"
                [(ngModel)]="specialCase.details.startDate"
                [max]="
                  specialCase.details.childcareType === 'papa-leave'
                    ? getPapaLeaveMaxStartDate(i)
                    : null
                "
                [min]="
                  specialCase.details.childcareType === 'extended-1-6'
                    ? getExtended16ChildcareMinStartDate(i)
                    : specialCase.details.childcareType === 'extended-2'
                      ? getExtended2ChildcareMinStartDate(i)
                      : null
                "
                (change)="
                  calculateChildcarePeriod(i);
                  validatePapaLeaveInput(i);
                  validateBasicChildcareInput(i);
                  validateExtended16ChildcareInput(i);
                  validateExtended2ChildcareInput(i);
                  validateSimilarMeasuresInput(i)
                "
                [class.invalid]="
                  (specialCase.details.childcareType === 'papa-leave' &&
                    isPapaLeaveStartDateInvalid(i)) ||
                  (specialCase.details.childcareType === 'basic' &&
                    isBasicChildcareStartDateInvalid(i)) ||
                  (specialCase.details.childcareType === 'extended-1-6' &&
                    isExtended16ChildcareStartDateInvalid(i)) ||
                  (specialCase.details.childcareType === 'extended-2' &&
                    isExtended2ChildcareStartDateInvalid(i))
                "
                class="form-input"
              />
              <div class="field-hint" *ngIf="specialCase.details.childcareType === 'papa-leave'">
                ç”£å¾Œãƒ‘ãƒ‘è‚²ä¼‘ã¯å‡ºç”Ÿå¾Œ8é€±é–“ä»¥å†…ã«é–‹å§‹ã—ã¦ãã ã•ã„
              </div>
              <div class="field-hint" *ngIf="specialCase.details.childcareType === 'basic'">
                åŸºæœ¬ã®è‚²å…ä¼‘æ¥­ã¯å­ãŒ1æ­³ã«ãªã‚‹æ—¥ã¾ã§å–å¾—å¯èƒ½ã§ã™
              </div>
              <div class="field-hint" *ngIf="specialCase.details.childcareType === 'extended-1-6'">
                å»¶é•·è‚²å…ä¼‘æ¥­ã¯å­ãŒ1æ­³ã«ãªã‚‹æ—¥ä»¥é™ã€1æ­³6ã‹æœˆã«ãªã‚‹æ—¥ã¾ã§å–å¾—å¯èƒ½ã§ã™
              </div>
              <div class="field-hint" *ngIf="specialCase.details.childcareType === 'extended-2'">
                å»¶é•·è‚²å…ä¼‘æ¥­ã¯å­ãŒ1æ­³6ã‹æœˆã«ãªã‚‹æ—¥ä»¥é™ã€2æ­³ã«ãªã‚‹æ—¥ã¾ã§å–å¾—å¯èƒ½ã§ã™
              </div>
            </div>

            <div class="form-group">
              <label [for]="'childcare-end-' + i" class="form-label">è‚²å…ä¼‘æ¥­çµ‚äº†äºˆå®šæ—¥:</label>
              <input
                [id]="'childcare-end-' + i"
                type="date"
                [(ngModel)]="specialCase.details.endDate"
                [max]="
                  specialCase.details.childcareType === 'papa-leave'
                    ? getPapaLeaveMaxEndDate(i)
                    : specialCase.details.childcareType === 'basic'
                      ? getBasicChildcareMaxEndDate(i)
                      : specialCase.details.childcareType === 'extended-1-6'
                        ? getExtended16ChildcareMaxEndDate(i)
                        : specialCase.details.childcareType === 'extended-2'
                          ? getExtended2ChildcareMaxEndDate(i)
                          : null
                "
                (change)="
                  calculateChildcarePeriod(i);
                  validatePapaLeaveInput(i);
                  validateBasicChildcareInput(i);
                  validateExtended16ChildcareInput(i);
                  validateExtended2ChildcareInput(i);
                  validateSimilarMeasuresInput(i)
                "
                [class.invalid]="
                  (specialCase.details.childcareType === 'papa-leave' &&
                    isPapaLeaveEndDateInvalid(i)) ||
                  (specialCase.details.childcareType === 'basic' &&
                    isBasicChildcareEndDateInvalid(i)) ||
                  (specialCase.details.childcareType === 'extended-1-6' &&
                    isExtended16ChildcareEndDateInvalid(i)) ||
                  (specialCase.details.childcareType === 'extended-2' &&
                    isExtended2ChildcareEndDateInvalid(i))
                "
                class="form-input"
              />
              <div class="field-hint" *ngIf="specialCase.details.childcareType === 'papa-leave'">
                ç”£å¾Œãƒ‘ãƒ‘è‚²ä¼‘ã¯æœ€å¤§4é€±é–“ï¼ˆ28æ—¥ï¼‰ã¾ã§å–å¾—å¯èƒ½ã§ã™
              </div>
              <div class="field-hint" *ngIf="specialCase.details.childcareType === 'basic'">
                åŸºæœ¬ã®è‚²å…ä¼‘æ¥­ã¯å­ãŒ1æ­³ã«ãªã‚‹æ—¥ã¾ã§å–å¾—å¯èƒ½ã§ã™
              </div>
              <div class="field-hint" *ngIf="specialCase.details.childcareType === 'extended-1-6'">
                å»¶é•·è‚²å…ä¼‘æ¥­ã¯å­ãŒ1æ­³6ã‹æœˆã«ãªã‚‹æ—¥ã¾ã§å–å¾—å¯èƒ½ã§ã™
              </div>
              <div class="field-hint" *ngIf="specialCase.details.childcareType === 'extended-2'">
                å»¶é•·è‚²å…ä¼‘æ¥­ã¯å­ãŒ2æ­³ã«ãªã‚‹æ—¥ã¾ã§å–å¾—å¯èƒ½ã§ã™
              </div>
            </div>

            <!-- å»¶é•·ç†ç”±ï¼ˆå»¶é•·è‚²å…ä¼‘æ¥­ã®å ´åˆã®ã¿è¡¨ç¤ºï¼‰ -->
            <div class="form-group full-width" *ngIf="isExtendedChildcare(i)">
              <label [for]="'extension-reason-' + i">å»¶é•·ç†ç”±:</label>
              <div class="custom-select-wrapper">
                <div
                  class="custom-select"
                  [class.open]="extensionReasonDropdownOpen[i]"
                  (click)="toggleExtensionReasonDropdown(i)"
                  (keydown.enter)="toggleExtensionReasonDropdown(i)"
                  (keydown.space)="toggleExtensionReasonDropdown(i)"
                  tabindex="0"
                >
                  <div class="select-display">
                    {{ getExtensionReasonDisplayText(specialCase.details.extensionReason) }}
                    <span class="dropdown-arrow">â–¼</span>
                  </div>
                  <div class="options-list" *ngIf="extensionReasonDropdownOpen[i]">
                    <div
                      class="option-item"
                      [class.selected]="specialCase.details.extensionReason === ''"
                      (click)="selectExtensionReason(i, ''); $event.stopPropagation()"
                      (keydown.enter)="selectExtensionReason(i, ''); $event.stopPropagation()"
                      tabindex="0"
                    >
                      é¸æŠã—ã¦ãã ã•ã„
                    </div>
                    <div
                      class="option-item"
                      [class.selected]="
                        specialCase.details.extensionReason === 'nursery-unavailable'
                      "
                      (click)="
                        selectExtensionReason(i, 'nursery-unavailable'); $event.stopPropagation()
                      "
                      (keydown.enter)="
                        selectExtensionReason(i, 'nursery-unavailable'); $event.stopPropagation()
                      "
                      tabindex="0"
                    >
                      ä¿è‚²æ‰€ç­‰ã«å…¥æ‰€ã§ããªã„
                    </div>
                    <div
                      class="option-item"
                      [class.selected]="
                        specialCase.details.extensionReason === 'spouse-circumstances'
                      "
                      (click)="
                        selectExtensionReason(i, 'spouse-circumstances'); $event.stopPropagation()
                      "
                      (keydown.enter)="
                        selectExtensionReason(i, 'spouse-circumstances'); $event.stopPropagation()
                      "
                      tabindex="0"
                    >
                      é…å¶è€…ã®æ­»äº¡ãƒ»è² å‚·ãƒ»ç–¾ç—…ç­‰
                    </div>
                    <div
                      class="option-item"
                      [class.selected]="specialCase.details.extensionReason === 'spouse-separation'"
                      (click)="
                        selectExtensionReason(i, 'spouse-separation'); $event.stopPropagation()
                      "
                      (keydown.enter)="
                        selectExtensionReason(i, 'spouse-separation'); $event.stopPropagation()
                      "
                      tabindex="0"
                    >
                      é…å¶è€…ã¨ã®åˆ¥å±…ç­‰
                    </div>
                    <div
                      class="option-item"
                      [class.selected]="
                        specialCase.details.extensionReason === 'spouse-work-restart'
                      "
                      (click)="
                        selectExtensionReason(i, 'spouse-work-restart'); $event.stopPropagation()
                      "
                      (keydown.enter)="
                        selectExtensionReason(i, 'spouse-work-restart'); $event.stopPropagation()
                      "
                      tabindex="0"
                    >
                      é…å¶è€…ã®è·å ´å¾©å¸°
                    </div>
                  </div>
                </div>
              </div>
              <div class="field-hint" *ngIf="specialCase.details.childcareType === 'extended-1-6'">
                å»¶é•·è‚²å…ä¼‘æ¥­ã«ã¯ç‰¹åˆ¥ãªç†ç”±ãŒå¿…è¦ã§ã™ã€‚è©²å½“ã™ã‚‹ç†ç”±ã‚’é¸æŠã—ã¦ãã ã•ã„
              </div>
              <div class="field-hint" *ngIf="specialCase.details.childcareType === 'extended-2'">
                2æ­³ã¾ã§ã®å»¶é•·è‚²å…ä¼‘æ¥­ã«ã¯ã€1æ­³6ã‹æœˆæ™‚ç‚¹ã§ã®ç‰¹åˆ¥ãªäº‹æƒ…ã®ç¶™ç¶šãŒå¿…è¦ã§ã™
              </div>
            </div>

            <!-- ç”£å¾Œãƒ‘ãƒ‘è‚²ä¼‘ã®åˆ†å‰²å–å¾—ï¼ˆç”£å¾Œãƒ‘ãƒ‘è‚²ä¼‘ã®å ´åˆã®ã¿è¡¨ç¤ºï¼‰ -->
            <div
              class="form-group full-width"
              *ngIf="specialCase.details.childcareType === 'papa-leave'"
            >
              <label [for]="'papa-split-' + i">åˆ†å‰²å–å¾—:</label>
              <select [id]="'papa-split-' + i" [(ngModel)]="specialCase.details.papaSplit">
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="no-split">åˆ†å‰²ãªã—ï¼ˆä¸€æ‹¬å–å¾—ï¼‰</option>
                <option value="split-2">2å›ã«åˆ†å‰²</option>
              </select>
            </div>

            <!-- ç”£å¾Œãƒ‘ãƒ‘è‚²ä¼‘ã®æœŸé–“ãƒã‚§ãƒƒã‚¯çµæœè¡¨ç¤º -->
            <div
              class="form-group full-width"
              *ngIf="
                specialCase.details.childcareType === 'papa-leave' && getPapaLeaveValidation(i)
              "
            >
              <div
                class="validation-result validation-result-unified"
                [class.error]="!getPapaLeaveValidation(i)?.isValid"
              >
                <h5>ç”£å¾Œãƒ‘ãƒ‘è‚²ä¼‘ æœŸé–“ãƒã‚§ãƒƒã‚¯çµæœ</h5>

                <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
                <div
                  class="validation-errors"
                  *ngIf="(getPapaLeaveValidation(i)?.errors?.length || 0) > 0"
                >
                  <div
                    class="error-item"
                    *ngFor="let error of getPapaLeaveValidation(i)?.errors || []"
                  >
                    <i class="icon-warning"></i>
                    {{ error }}
                  </div>
                </div>

                <!-- æœŸé–“æƒ…å ±è¡¨ç¤º -->
                <div class="period-summary" *ngIf="getPapaLeaveCalculation(i)">
                  <div class="summary-item">
                    <span class="label">ç”³è«‹æœŸé–“:</span>
                    <span class="value">{{ getPapaLeaveCalculation(i)?.requestedDays }}æ—¥é–“</span>
                  </div>
                  <div class="summary-item">
                    <span class="label">æ³•å®šä¸Šé™:</span>
                    <span class="value">{{ getPapaLeaveCalculation(i)?.maxAllowedDays }}æ—¥é–“</span>
                  </div>
                  <div
                    class="summary-item"
                    [class.valid]="getPapaLeaveCalculation(i)?.isWithinLimit"
                    [class.invalid]="!getPapaLeaveCalculation(i)?.isWithinLimit"
                  >
                    <span class="label">åˆ¤å®š:</span>
                    <span class="value">{{
                      getPapaLeaveCalculation(i)?.isWithinLimit ? 'é©æ­£' : 'åˆ¶é™è¶…é'
                    }}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- åŸºæœ¬è‚²å…ä¼‘æ¥­ã®æœŸé–“ãƒã‚§ãƒƒã‚¯çµæœè¡¨ç¤º -->
            <div
              class="form-group full-width"
              *ngIf="
                specialCase.details.childcareType === 'basic' && getBasicChildcareValidation(i)
              "
            >
              <div
                class="validation-result validation-result-unified"
                [class.error]="!getBasicChildcareValidation(i)?.isValid"
              >
                <h5>åŸºæœ¬è‚²å…ä¼‘æ¥­ æœŸé–“ãƒã‚§ãƒƒã‚¯çµæœ</h5>

                <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
                <div
                  class="validation-errors"
                  *ngIf="(getBasicChildcareValidation(i)?.errors?.length || 0) > 0"
                >
                  <div
                    class="error-item"
                    *ngFor="let error of getBasicChildcareValidation(i)?.errors || []"
                  >
                    <i class="icon-warning"></i>
                    {{ error }}
                  </div>
                </div>

                <!-- è­¦å‘Šè¡¨ç¤º -->
                <div
                  class="validation-warnings"
                  *ngIf="(getBasicChildcareValidation(i)?.warnings?.length || 0) > 0"
                >
                  <div
                    class="warning-item"
                    *ngFor="let warning of getBasicChildcareValidation(i)?.warnings || []"
                  >
                    <i class="icon-info"></i>
                    {{ warning }}
                  </div>
                </div>

                <!-- æœŸé–“æƒ…å ±è¡¨ç¤º -->
                <div class="period-summary" *ngIf="getBasicChildcareCalculation(i)">
                  <div class="summary-item">
                    <span class="label">ç”³è«‹æœŸé–“:</span>
                    <span class="value"
                      >{{ getBasicChildcareCalculation(i)?.requestedDays }}æ—¥é–“</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="label">æ³•å®šä¸Šé™:</span>
                    <span class="value"
                      >{{ getBasicChildcareCalculation(i)?.maxAllowedDays }}æ—¥é–“</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="label">çµ‚äº†æ™‚ã®å­ã®å¹´é½¢:</span>
                    <span class="value">{{ getBasicChildcareCalculation(i)?.childAge }}</span>
                  </div>
                  <div
                    class="summary-item"
                    [class.valid]="getBasicChildcareCalculation(i)?.isWithinLimit"
                    [class.invalid]="!getBasicChildcareCalculation(i)?.isWithinLimit"
                  >
                    <span class="label">åˆ¤å®š:</span>
                    <span class="value">{{
                      getBasicChildcareCalculation(i)?.isWithinLimit ? 'é©æ­£' : 'åˆ¶é™è¶…é'
                    }}</span>
                  </div>
                  <div class="summary-item" *ngIf="getBasicChildcareCalculation(i)?.canExtend">
                    <span class="label">å»¶é•·å¯èƒ½æ€§:</span>
                    <span class="value extend-available">å»¶é•·è‚²å…ä¼‘æ¥­ã¸ã®ç§»è¡ŒãŒå¯èƒ½ã§ã™</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- å»¶é•·è‚²å…ä¼‘æ¥­ï¼ˆ1æ­³ï½1æ­³6ã‹æœˆï¼‰ã®æœŸé–“ãƒã‚§ãƒƒã‚¯çµæœè¡¨ç¤º -->
            <div
              class="form-group full-width"
              *ngIf="
                specialCase.details.childcareType === 'extended-1-6' &&
                getExtended16ChildcareValidation(i)
              "
            >
              <div
                class="validation-result validation-result-unified"
                [class.error]="!getExtended16ChildcareValidation(i)?.isValid"
              >
                <h5>å»¶é•·è‚²å…ä¼‘æ¥­ï¼ˆ1æ­³ï½1æ­³6ã‹æœˆï¼‰ æœŸé–“ãƒã‚§ãƒƒã‚¯çµæœ</h5>

                <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
                <div
                  class="validation-errors"
                  *ngIf="(getExtended16ChildcareValidation(i)?.errors?.length || 0) > 0"
                >
                  <div
                    class="error-item"
                    *ngFor="let error of getExtended16ChildcareValidation(i)?.errors || []"
                  >
                    <i class="icon-warning"></i>
                    {{ error }}
                  </div>
                </div>

                <!-- è­¦å‘Šè¡¨ç¤º -->
                <div
                  class="validation-warnings"
                  *ngIf="(getExtended16ChildcareValidation(i)?.warnings?.length || 0) > 0"
                >
                  <div
                    class="warning-item"
                    *ngFor="let warning of getExtended16ChildcareValidation(i)?.warnings || []"
                  >
                    <i class="icon-info"></i>
                    {{ warning }}
                  </div>
                </div>

                <!-- æœŸé–“æƒ…å ±è¡¨ç¤º -->
                <div class="period-summary" *ngIf="getExtended16ChildcareCalculation(i)">
                  <div class="summary-item">
                    <span class="label">ç”³è«‹æœŸé–“:</span>
                    <span class="value"
                      >{{ getExtended16ChildcareCalculation(i)?.requestedDays }}æ—¥é–“</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="label">æ³•å®šä¸Šé™:</span>
                    <span class="value"
                      >{{ getExtended16ChildcareCalculation(i)?.maxAllowedDays }}æ—¥é–“</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="label">çµ‚äº†æ™‚ã®å­ã®å¹´é½¢:</span>
                    <span class="value">{{ getExtended16ChildcareCalculation(i)?.childAge }}</span>
                  </div>
                  <div class="summary-item">
                    <span class="label">å»¶é•·ç†ç”±:</span>
                    <span class="value">{{
                      getExtended16ChildcareCalculation(i)?.extensionReason
                    }}</span>
                  </div>
                  <div
                    class="summary-item"
                    [class.valid]="getExtended16ChildcareCalculation(i)?.isWithinLimit"
                    [class.invalid]="!getExtended16ChildcareCalculation(i)?.isWithinLimit"
                  >
                    <span class="label">åˆ¤å®š:</span>
                    <span class="value">{{
                      getExtended16ChildcareCalculation(i)?.isWithinLimit ? 'é©æ­£' : 'åˆ¶é™è¶…é'
                    }}</span>
                  </div>
                  <div
                    class="summary-item"
                    *ngIf="getExtended16ChildcareCalculation(i)?.canExtendFurther"
                  >
                    <span class="label">ã•ã‚‰ãªã‚‹å»¶é•·å¯èƒ½æ€§:</span>
                    <span class="value extend-available"
                      >2æ­³ã¾ã§ã®å»¶é•·è‚²å…ä¼‘æ¥­ã¸ã®ç§»è¡ŒãŒå¯èƒ½ã§ã™</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- å»¶é•·è‚²å…ä¼‘æ¥­ï¼ˆ1æ­³6ã‹æœˆï½2æ­³ï¼‰ã®æœŸé–“ãƒã‚§ãƒƒã‚¯çµæœè¡¨ç¤º -->
            <div
              class="form-group full-width"
              *ngIf="
                specialCase.details.childcareType === 'extended-2' &&
                getExtended2ChildcareValidation(i)
              "
            >
              <div
                class="validation-result validation-result-unified"
                [class.error]="!getExtended2ChildcareValidation(i)?.isValid"
              >
                <h5>å»¶é•·è‚²å…ä¼‘æ¥­ï¼ˆ1æ­³6ã‹æœˆï½2æ­³ï¼‰ æœŸé–“ãƒã‚§ãƒƒã‚¯çµæœ</h5>

                <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
                <div
                  class="validation-errors"
                  *ngIf="(getExtended2ChildcareValidation(i)?.errors?.length || 0) > 0"
                >
                  <div
                    class="error-item"
                    *ngFor="let error of getExtended2ChildcareValidation(i)?.errors || []"
                  >
                    <i class="icon-warning"></i>
                    {{ error }}
                  </div>
                </div>

                <!-- è­¦å‘Šè¡¨ç¤º -->
                <div
                  class="validation-warnings"
                  *ngIf="(getExtended2ChildcareValidation(i)?.warnings?.length || 0) > 0"
                >
                  <div
                    class="warning-item"
                    *ngFor="let warning of getExtended2ChildcareValidation(i)?.warnings || []"
                  >
                    <i class="icon-info"></i>
                    {{ warning }}
                  </div>
                </div>

                <!-- æœŸé–“æƒ…å ±è¡¨ç¤º -->
                <div class="period-summary" *ngIf="getExtended2ChildcareCalculation(i)">
                  <div class="summary-item">
                    <span class="label">ç”³è«‹æœŸé–“:</span>
                    <span class="value"
                      >{{ getExtended2ChildcareCalculation(i)?.requestedDays }}æ—¥é–“</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="label">æ³•å®šä¸Šé™:</span>
                    <span class="value"
                      >{{ getExtended2ChildcareCalculation(i)?.maxAllowedDays }}æ—¥é–“</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="label">çµ‚äº†æ™‚ã®å­ã®å¹´é½¢:</span>
                    <span class="value">{{ getExtended2ChildcareCalculation(i)?.childAge }}</span>
                  </div>
                  <div class="summary-item">
                    <span class="label">å»¶é•·ç†ç”±:</span>
                    <span class="value">{{
                      getExtended2ChildcareCalculation(i)?.extensionReason
                    }}</span>
                  </div>
                  <div
                    class="summary-item"
                    [class.valid]="getExtended2ChildcareCalculation(i)?.isWithinLimit"
                    [class.invalid]="!getExtended2ChildcareCalculation(i)?.isWithinLimit"
                  >
                    <span class="label">åˆ¤å®š:</span>
                    <span class="value">{{
                      getExtended2ChildcareCalculation(i)?.isWithinLimit ? 'é©æ­£' : 'åˆ¶é™è¶…é'
                    }}</span>
                  </div>
                  <div class="summary-item max-extension">
                    <span class="label">å»¶é•·ãƒ¬ãƒ™ãƒ«:</span>
                    <span class="value final-extension">æ³•å®šæœ€å¤§å»¶é•·ï¼ˆ2æ­³ã¾ã§ï¼‰</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- è‚²å…ä¼‘æ¥­ã«æº–ãšã‚‹æªç½®ã®æœŸé–“ãƒã‚§ãƒƒã‚¯çµæœè¡¨ç¤º -->
            <div
              class="form-group full-width"
              *ngIf="
                specialCase.details.childcareType === 'similar-measures' &&
                getSimilarMeasuresValidation(i)
              "
            >
              <div
                class="validation-result validation-result-unified"
                [class.error]="!getSimilarMeasuresValidation(i)?.isValid"
              >
                <h5>è‚²å…ä¼‘æ¥­ã«æº–ãšã‚‹æªç½® æœŸé–“ãƒã‚§ãƒƒã‚¯çµæœ</h5>

                <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
                <div
                  class="validation-errors"
                  *ngIf="(getSimilarMeasuresValidation(i)?.errors?.length || 0) > 0"
                >
                  <div
                    class="error-item"
                    *ngFor="let error of getSimilarMeasuresValidation(i)?.errors || []"
                  >
                    <i class="icon-warning"></i>
                    {{ error }}
                  </div>
                </div>

                <!-- è­¦å‘Šè¡¨ç¤º -->
                <div
                  class="validation-warnings"
                  *ngIf="(getSimilarMeasuresValidation(i)?.warnings?.length || 0) > 0"
                >
                  <div
                    class="warning-item"
                    *ngFor="let warning of getSimilarMeasuresValidation(i)?.warnings || []"
                  >
                    <i class="icon-info"></i>
                    {{ warning }}
                  </div>
                </div>

                <!-- æœŸé–“æƒ…å ±è¡¨ç¤º -->
                <div class="period-summary" *ngIf="getSimilarMeasuresCalculation(i)">
                  <div class="summary-item">
                    <span class="label">ç”³è«‹æœŸé–“:</span>
                    <span class="value"
                      >{{ getSimilarMeasuresCalculation(i)?.requestedDays }}æ—¥é–“</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="label">çµ‚äº†æ™‚ã®å­ã®å¹´é½¢:</span>
                    <span class="value">{{ getSimilarMeasuresCalculation(i)?.childAge }}</span>
                  </div>
                  <div class="summary-item">
                    <span class="label">æªç½®ã®ç¨®é¡:</span>
                    <span class="value">{{ getSimilarMeasuresCalculation(i)?.measureType }}</span>
                  </div>
                  <div class="summary-item similar-measures">
                    <span class="label">åˆ¶åº¦åŒºåˆ†:</span>
                    <span class="value special-measure">è‚²å…ä¼‘æ¥­ã«æº–ãšã‚‹æªç½®</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- è¨ˆç®—çµæœè¡¨ç¤ºï¼ˆçµ±åˆç‰ˆï¼‰ -->
            <div class="form-group full-width" *ngIf="getCalculatedChildcarePeriod(i)">
              <div class="calculated-period">
                <h5 class="calculated-period-title">ç¤¾ä¼šä¿é™ºæ–™å…é™¤æœŸé–“ã®è¨ˆç®—çµæœ</h5>
                <div class="period-info">
                  <div class="period-item">
                    <span class="label">æœˆé¡ä¿é™ºæ–™å…é™¤æœŸé–“:</span>
                    <span class="value">{{
                      getCalculatedChildcarePeriod(i)?.monthlyPremiumExemption
                    }}</span>
                  </div>
                  <div class="period-item" *ngIf="getCalculatedChildcarePeriod(i)?.bonusNote">
                    <span class="label">è³ä¸ä¿é™ºæ–™å…é™¤:</span>
                    <span class="value">{{ getCalculatedChildcarePeriod(i)?.bonusNote }}</span>
                  </div>
                  <div
                    class="period-item special-note"
                    *ngIf="getCalculatedChildcarePeriod(i)?.specialNote"
                  >
                    <span class="label">ç‰¹è¨˜äº‹é …:</span>
                    <span class="value">{{ getCalculatedChildcarePeriod(i)?.specialNote }}</span>
                  </div>
                </div>

                <!-- ç¤¾ä¼šä¿é™ºæ–™å…é™¤æœŸé–“ã®è¡¨ç¤ºã‚’çµ±åˆï¼ˆè‚²å…ä¼‘æ¥­ã«æº–ãšã‚‹æªç½®ä»¥å¤–ï¼‰ -->
                <div
                  class="exemption-period-display"
                  *ngIf="specialCase.details.childcareType !== 'similar-measures'"
                >
                  <div class="exemption-bar">
                    <span class="exemption-label">ç¤¾ä¼šä¿é™ºæ–™å…é™¤æœŸé–“:</span>
                    <span class="exemption-period">{{ getChildcareExemptionPeriod(i) }}</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-group full-width">
              <label [for]="'childcare-remarks-' + i">å‚™è€ƒ:</label>
              <textarea
                [id]="'childcare-remarks-' + i"
                [(ngModel)]="specialCase.details.remarks"
                placeholder="è‚²å…ä¼‘æ¥­ã«é–¢ã™ã‚‹ç‰¹è¨˜äº‹é …ãªã©"
              ></textarea>
            </div>
          </div>

          <!-- è‚²ä¼‘ã®ä¿å­˜ãƒœã‚¿ãƒ³ -->
          <div class="case-save-section">
            <button
              class="btn-save-case"
              (click)="saveSpecialCase(i)"
              [disabled]="!canSaveChildcareCase(i)"
            >
              <i class="icon-save"></i>
              ã“ã®æƒ…å ±ã‚’ä¿å­˜
            </button>
            <div class="save-status" *ngIf="specialCase.saveStatus">
              <span class="status-icon" [class]="specialCase.saveStatus">
                {{
                  specialCase.saveStatus === 'saved'
                    ? 'âœ“'
                    : specialCase.saveStatus === 'saving'
                      ? 'â³'
                      : 'âœ—'
                }}
              </span>
              <span class="status-text">
                {{ getSpecialCaseSaveStatusText(specialCase.saveStatus) }}
              </span>
            </div>
          </div>
        </div>

        <!-- ãã®ä»–ã®äº‹ä¾‹ã®ç°¡æ˜“ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div
          class="case-details"
          *ngIf="
            specialCase.type &&
            specialCase.type !== 'maternity-leave' &&
            specialCase.type !== 'childcare-leave'
          "
        >
          <!-- æ³¨æ„æ›¸ã -->
          <div
            class="notice-section"
            *ngIf="
              specialCase.type === 'other-leave' ||
              specialCase.type === 'secondment' ||
              specialCase.type === 'multiple-workplace'
            "
          >
            <div class="notice-box">
              <i class="icon-info"></i>
              <div class="notice-content">
                <h5>é‡è¦ãªãŠçŸ¥ã‚‰ã›</h5>
                <p>ã“ã®é …ç›®ã«ã¤ã„ã¦ã¯ã€è©³ç´°ãªçŠ¶æ³ã‚’è¨˜å…¥ã®ä¸Šã€å¿…ãšäººäº‹æ‹…å½“è€…ã«ã”ç›¸è«‡ãã ã•ã„ã€‚</p>
                <p>é©åˆ‡ãªç¤¾ä¼šä¿é™ºã®é©ç”¨ã«ã¯ã€å€‹åˆ¥ã®æ¤œè¨ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
              </div>
            </div>
          </div>

          <div class="form-group full-width">
            <label [for]="'other-remarks-' + i">è©³ç´°ãƒ»å‚™è€ƒ:</label>
            <textarea
              [id]="'other-remarks-' + i"
              [(ngModel)]="specialCase.details.remarks"
              [placeholder]="getPlaceholderText(specialCase.type)"
            ></textarea>
          </div>

          <!-- ãã®ä»–ã®äº‹ä¾‹ã®ä¿å­˜ãƒœã‚¿ãƒ³ -->
          <div class="case-save-section">
            <button
              class="btn-save-case"
              (click)="saveSpecialCase(i)"
              [disabled]="!canSaveOtherCase(i)"
            >
              <i class="icon-save"></i>
              ã“ã®æƒ…å ±ã‚’ä¿å­˜
            </button>
            <div class="save-status" *ngIf="specialCase.saveStatus">
              <span class="status-icon" [class]="specialCase.saveStatus">
                {{
                  specialCase.saveStatus === 'saved'
                    ? 'âœ“'
                    : specialCase.saveStatus === 'saving'
                      ? 'â³'
                      : 'âœ—'
                }}
              </span>
              <span class="status-text">
                {{ getSpecialCaseSaveStatusText(specialCase.saveStatus) }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="add-case-section">
        <button class="btn-add-case" (click)="addSpecialCase()">
          <i class="icon-plus"></i>
          äº‹ä¾‹ã‚’è¿½åŠ 
        </button>
      </div>
    </div>
  </div>

  <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
  <div class="action-buttons" *ngIf="!judgmentResult">
    <!-- åˆ¤å®šçµæœãŒãªã„æ™‚ã®ã¿è¡¨ç¤º -->
  </div>
</div>
